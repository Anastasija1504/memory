<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Memory ‚Äì —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            background: #f5f6fa;
            color: #222;
        }

        .top-bar {
            background: #2f3640;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .top-bar span {
            margin-right: 15px;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            padding: 30px 40px 40px;
        }

        h1 {
            margin-top: 0;
        }

        .develops {
            margin-top: 10px;
            font-size: 14px;
        }

        .tag {
            display: inline-block;
            margin-right: 8px;
            margin-top: 4px;
            padding: 3px 8px;
            border-radius: 999px;
            background: #e1f0ff;
            color: #1e6fd9;
            font-size: 12px;
        }

        .field-row {
            margin-top: 20px;
        }

        input[type="text"] {
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 220px;
        }

        button {
            border: none;
            border-radius: 4px;
            padding: 10px 18px;
            font-size: 14px;
            cursor: pointer;
        }

        .primary-btn {
            background: #0052cc;
            color: #fff;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .status-row {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            justify-items: center;
            max-width: 420px;
            margin: 0 auto;
        }

        .card {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: background 0.15s ease, transform 0.1s ease;
            user-select: none;
        }

        .card.open {
            background: #dcdde1;
            transform: scale(1.03);
        }

        .card.matched {
            background: #4cd137;
            color: #ffffff;
            cursor: default;
            transform: none;
        }

        #result-screen {
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(20px);}
            to   {opacity: 1; transform: translateY(0);}
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<div class="top-bar">
    <div><strong>–ú–µ–º–æ—Ä—ñ</strong></div>
    <div>
        <span>–†—ñ–≤–µ–Ω—å: <span id="top-level">0</span> / 6</span>
        <span>–ß–∞—Å: <span id="top-time">00:00</span></span>
    </div>
</div>

<div class="container" id="start-screen">
    <h1>Memory ‚Äì —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</h1>
    <p>–¢—Ä–µ–Ω–∞–∂–µ—Ä –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É –∫–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–æ—ó –ø–∞–º'—è—Ç—ñ.</p>

    <div class="develops">
        <span class="tag">–ö–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–∞ –ø–∞–º‚Äô—è—Ç—å</span>
        <span class="tag">–°–ø–æ—Å—Ç–µ—Ä–µ–∂–ª–∏–≤—ñ—Å—Ç—å</span>
        <span class="tag">–û–±—Ä–∞–∑–Ω–µ –º–∏—Å–ª–µ–Ω–Ω—è</span>
    </div>

    <div class="field-row">
        <label>–Ü–º‚Äô—è —É—á–∞—Å–Ω–∏–∫–∞:</label><br>
        <input type="text" id="player-name" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º‚Äô—è">
    </div>

    <button class="primary-btn" id="start-btn">–ü–æ—á–∞—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</button>
</div>

<div class="container hidden" id="game-screen">
    <h2>–ó–Ω–∞–π–¥—ñ—Ç—å –ø–∞—Ä–∏ –∫–∞—Ä—Ç–æ–∫</h2>

    <div class="status-row">
        <div>–†—ñ–≤–µ–Ω—å: <span id="level-label">1</span> / 6</div>
        <div>–ü–∞—Ä –∑–Ω–∞–π–¥–µ–Ω–æ: <span id="matches-label">0</span></div>
        <div>–°–ø—Ä–æ–±: <span id="moves-label">0</span></div>
    </div>

    <div class="grid" id="grid"></div>
</div>

<div class="container hidden" id="result-screen">
    <h2>üéâ –í—ñ—Ç–∞—î–º–æ! –í–∏ –ø—Ä–æ–π—à–ª–∏ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ!</h2>
    <p id="res-name"></p>
    <p id="res-time"></p>
    <p id="res-moves"></p>
</div>

<script>
const TOTAL_LEVELS = 6;
const baseCardsCount = 8;
const cardsIncrement = 4;

const icons = ["‚úàÔ∏è","‚òÇÔ∏è","üöÄ","üòÄ","üê±","‚≠ê","‚öΩ","üçé","üéß","üìö","üöó","üåà","üé≤","üèÄ","üéÅ"];

let playerName = "";
let currentLevel = 0;
let cards = [];
let openCards = [];
let matchedPairs = 0;
let moves = 0;
let totalSeconds = 0;
let timerId = null;

const startScreen = document.getElementById("start-screen");
const gameScreen  = document.getElementById("game-screen");
const resultScreen = document.getElementById("result-screen");

const startBtn = document.getElementById("start-btn");
const playerInput = document.getElementById("player-name");

const gridEl = document.getElementById("grid");
const levelLabel = document.getElementById("level-label");
const matchesLabel = document.getElementById("matches-label");
const movesLabel = document.getElementById("moves-label");
const topLevel = document.getElementById("top-level");
const topTime = document.getElementById("top-time");

const resName = document.getElementById("res-name");
const resTime = document.getElementById("res-time");
const resMoves = document.getElementById("res-moves");

function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function formatTime(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return (m < 10 ? "0"+m : m)+":"+(s < 10 ? "0"+s : s);
}

function startTimer() {
    timerId = setInterval(() => {
        totalSeconds++;
        topTime.textContent = formatTime(totalSeconds);
    }, 1000);
}

function stopTimer() {
    clearInterval(timerId);
}

function startGame() {
    startScreen.classList.add("hidden");
    gameScreen.classList.remove("hidden");

    currentLevel = 1;
    totalSeconds = 0;
    moves = 0;

    topTime.textContent = "00:00";
    topLevel.textContent = currentLevel;

    startTimer();
    initLevel();
}

function initLevel() {
    const cardsCount = baseCardsCount + (currentLevel - 1) * cardsIncrement;
    const pairsCount = cardsCount / 2;

    cards = shuffle([...icons.slice(0, pairsCount), ...icons.slice(0, pairsCount)]);
    openCards = [];
    matchedPairs = 0;

    levelLabel.textContent = currentLevel;
    matchesLabel.textContent = `0 / ${pairsCount}`;
    movesLabel.textContent = moves;

    gridEl.innerHTML = "";
    cards.forEach((icon, index) => {
        const c = document.createElement("div");
        c.className = "card";
        c.dataset.index = index;
        gridEl.appendChild(c);
    });
}

function revealCard(index) {
    const cardElements = document.querySelectorAll(".card");
    const c = cardElements[index];

    if (c.classList.contains("open") || c.classList.contains("matched")) return;
    if (openCards.length === 2) return;

    c.classList.add("open");
    c.textContent = cards[index];
    openCards.push({ index, value: cards[index], element: c });

    if (openCards.length === 2) {
        moves++;
        movesLabel.textContent = moves;
        checkMatch();
    }
}

function checkMatch() {
    const [a, b] = openCards;
    if (a.value === b.value) {
        a.element.classList.remove("open");
        b.element.classList.remove("open");
        a.element.classList.add("matched");
        b.element.classList.add("matched");

        matchedPairs++;
        matchesLabel.textContent = `${matchedPairs} / ${cards.length / 2}`;

        openCards = [];

        if (matchedPairs === cards.length / 2) {
            setTimeout(nextLevelOrFinish, 600);
        }
    } else {
        setTimeout(() => {
            a.element.classList.remove("open");
            b.element.classList.remove("open");
            a.element.textContent = "";
            b.element.textContent = "";
            openCards = [];
        }, 600);
    }
}

function nextLevelOrFinish() {
    if (currentLevel < TOTAL_LEVELS) {
        currentLevel++;
        topLevel.textContent = currentLevel;
        initLevel();
    } else {
        stopTimer();

        gameScreen.classList.add("hidden");
        resultScreen.classList.remove("hidden");

        resName.textContent = `–£—á–∞—Å–Ω–∏–∫: ${playerName}`;
        resTime.textContent = `–ß–∞—Å: ${formatTime(totalSeconds)}`;
        resMoves.textContent = `–°–ø—Ä–æ–±: ${moves}`;

        shootConfetti();
        sendResultsToChatbot(playerName, totalSeconds, moves);
    }
}

function shootConfetti() {
    const duration = 2500;
    const end = Date.now() + duration;

    (function frame() {
        confetti({
            particleCount: 6,
            spread: 360,
            ticks: 70,
            origin: { x: Math.random(), y: Math.random() - 0.2 }
        });

        if (Date.now() < end) requestAnimationFrame(frame);
    })();
}

function sendResultsToChatbot(name, timeSeconds, movesCount) {

    const TOKEN  = '8517013691:AAElXeP_-V0-XqTIKJ9nFMUkwvXaW3qiziQ';
    const CHAT_ID = '1350269784';

    const text =
        'üß† –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ Memory-—Ç–µ—Å—Ç—É\n\n' +
        `üë§ –£—á–∞—Å–Ω–∏–∫: ${name}\n` +
        `‚è± –ß–∞—Å: ${formatTime(timeSeconds)} (${timeSeconds} —Å–µ–∫—É–Ω–¥)\n` +
        `üîÑ –°–ø—Ä–æ–±: ${movesCount}\n\n` +
        '–ó–±–µ—Ä–µ–∂–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ ‚úîÔ∏è';

    const url =
        `https://api.telegram.org/bot${TOKEN}/sendMessage` +
        `?chat_id=${CHAT_ID}` +
        `&text=${encodeURIComponent(text)}`;

    const img = new Image();
    img.src = url;
}

startBtn.addEventListener("click", () => {
    playerName = playerInput.value.trim() || "‚Äî";
    startGame();
});

gridEl.addEventListener("click", e => {
    const card = e.target.closest(".card");
    if (!card) return;
    revealCard(parseInt(card.dataset.index));
});
</script>
</body>
</html>
