<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Memory ‚Äì —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            background: #f5f6fa;
            color: #222;
        }

        .top-bar {
            background: #2f3640;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            padding: 30px 40px 40px;
        }

        .tag {
            display: inline-block;
            margin-right: 8px;
            margin-top: 4px;
            padding: 3px 8px;
            border-radius: 999px;
            background: #e1f0ff;
            color: #1e6fd9;
            font-size: 12px;
        }

        input {
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            min-width: 260px;
            margin-top: 5px;
        }

        input.error {
            border: 2px solid #ff3b3b;
            background: #ffe6e6;
        }

        .error-text {
            color: #d40000;
            font-size: 13px;
            display: none;
            margin-top: 4px;
        }

        .primary-btn {
            background: #0052cc;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 12px 20px;
            cursor: pointer;
            margin-top: 25px;
        }

        .secondary-btn {
            background: #f0f0f0;
            color: #222;
            border: none;
            border-radius: 4px;
            padding: 8px 14px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
        }

        .hidden { display: none; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            max-width: 420px;
            margin: 0 auto;
        }

        .card {
            width: 80px;
            height: 80px;
            background: #f0f0f0;
            font-size: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.15s;
        }

        .card.open { background: #dcdde1; transform: scale(1.05); }
        .card.matched { background: #4cd137; color: white; }

        #result-screen {
            text-align: center;
            animation: fadeIn .6s ease;
        }

        #details-block {
            margin-top: 15px;
            text-align: left;
            font-size: 14px;
        }

        #details-block ul {
            padding-left: 20px;
            margin: 8px 0 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>

    <!-- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—ñ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<div class="top-bar">
    <strong>–ú–µ–º–æ—Ä—ñ</strong>
    <div>
        –†—ñ–≤–µ–Ω—å: <span id="top-level">0</span> / 6
        &nbsp; | &nbsp;
        –ß–∞—Å: <span id="top-time">00:00</span>
    </div>
</div>

<!-- –°–¢–ê–†–¢–û–í–ò–ô –ï–ö–†–ê–ù -->
<div class="container" id="start-screen">
    <h1>Memory ‚Äì —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</h1>

    <p>
        <span class="tag">–ö–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω–∞ –ø–∞–º‚Äô—è—Ç—å</span>
        <span class="tag">–°–ø–æ—Å—Ç–µ—Ä–µ–∂–ª–∏–≤—ñ—Å—Ç—å</span>
        <span class="tag">–û–±—Ä–∞–∑–Ω–µ –º–∏—Å–ª–µ–Ω–Ω—è</span>
    </p>

    <label for="player-name">–Ü–º‚Äô—è —É—á–∞—Å–Ω–∏–∫–∞:</label><br>
    <input id="player-name" type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º‚Äô—è">

    <br><br>

    <label for="player-email">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ):</label><br>
    <input id="player-email" type="email" placeholder="email@example.com">
    <div id="email-error" class="error-text">–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É.</div>

    <button class="primary-btn" id="start-btn">–ü–æ—á–∞—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</button>
</div>

<!-- –ï–ö–†–ê–ù –ì–†–ò -->
<div class="container hidden" id="game-screen">
    <h2>–ó–Ω–∞–π–¥—ñ—Ç—å –ø–∞—Ä–∏ –∫–∞—Ä—Ç–æ–∫</h2>

    <p>
        –†—ñ–≤–µ–Ω—å: <span id="level-label">1</span> / 6<br>
        –ü–∞—Ä –∑–Ω–∞–π–¥–µ–Ω–æ: <span id="matches-label">0</span><br>
        –°–ø—Ä–æ–± –Ω–∞ —Ü—å–æ–º—É —Ä—ñ–≤–Ω—ñ: <span id="moves-label">0</span>
    </p>

    <div class="grid" id="grid"></div>
</div>

<!-- –ï–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–£ -->
<div class="container hidden" id="result-screen">
    <h2>üéâ –í—ñ—Ç–∞—î–º–æ! –í–∏ –ø—Ä–æ–π—à–ª–∏ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ!</h2>

    <p id="res-name"></p>
    <p id="res-email"></p>
    <p id="res-time"></p>
    <p id="res-moves"></p>

    <button id="details-btn" class="secondary-btn">–î–æ–∫–ª–∞–¥–Ω–æ</button>
    <div id="details-block" class="hidden"></div>
</div>

<script>
/* ---------------- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---------------- */
const TOTAL_LEVELS = 6;
const icons = ["‚úàÔ∏è","‚òÇÔ∏è","üöÄ","üòÄ","üê±","‚≠ê","‚öΩ","üçé","üéß","üìö","üöó","üåà","üé≤","üèÄ","üéÅ"];

/* ---------------- –°–¢–ê–ù ---------------- */
let nameUser = "", emailUser = "";
let level = 1;
let moves = 0;              // —Å–ø—Ä–æ–±–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
let totalMoves = 0;         // –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –∑–∞ –≤—Å—ñ —Ä—ñ–≤–Ω—ñ
let movesPerLevel = new Array(TOTAL_LEVELS).fill(0);

let matched = 0;
let cards = [];
let openCards = [];
let totalSeconds = 0;
let timer = null;

/* ---------------- DOM ---------------- */
const startScreen = document.getElementById("start-screen");
const gameScreen  = document.getElementById("game-screen");
const resultScreen= document.getElementById("result-screen");

const grid         = document.getElementById("grid");
const levelLabel   = document.getElementById("level-label");
const matchesLabel = document.getElementById("matches-label");
const movesLabel   = document.getElementById("moves-label");
const topLevel     = document.getElementById("top-level");
const topTime      = document.getElementById("top-time");

const emailField = document.getElementById("player-email");
const emailError = document.getElementById("email-error");

const resName  = document.getElementById("res-name");
const resEmail = document.getElementById("res-email");
const resTime  = document.getElementById("res-time");
const resMoves = document.getElementById("res-moves");

const detailsBtn   = document.getElementById("details-btn");
const detailsBlock = document.getElementById("details-block");

/* ---------------- –°–¢–ê–†–¢ ---------------- */
document.getElementById("start-btn").onclick = () => {
    const email = emailField.value.trim();

    // e-mail –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–π
    if (!email || !email.includes("@") || !email.includes(".")) {
        emailField.classList.add("error");
        emailError.style.display = "block";
        return;
    }

    emailField.classList.remove("error");
    emailError.style.display = "none";

    nameUser  = document.getElementById("player-name").value.trim() || "‚Äî";
    emailUser = email;

    // –°–∫–∏–¥–∞—î–º–æ –∑–∞–≥–∞–ª—å–Ω—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏
    level = 1;
    moves = 0;
    totalMoves = 0;
    movesPerLevel = new Array(TOTAL_LEVELS).fill(0);
    matched = 0;
    totalSeconds = 0;

    startScreen.classList.add("hidden");
    gameScreen.classList.remove("hidden");
    resultScreen.classList.add("hidden");
    detailsBlock.classList.add("hidden");
    detailsBlock.innerHTML = "";
    detailsBtn.textContent = "–î–æ–∫–ª–∞–¥–Ω–æ";

    startTimer();
    loadLevel();
};

/* ---------------- –¢–ê–ô–ú–ï–† ---------------- */
function startTimer() {
    timer = setInterval(() => {
        totalSeconds++;
        topTime.textContent = formatTime(totalSeconds);
    }, 1000);
}

function stopTimer() {
    clearInterval(timer);
}

function formatTime(s) {
    const m = Math.floor(s / 60);
    const ss = s % 60;
    return (m < 10 ? "0" : "") + m + ":" + (ss < 10 ? "0" : "") + ss;
}

/* ---------------- –†–Ü–í–ï–ù–¨ ---------------- */
function loadLevel() {
    const pairs = 4 + (level - 1) * 2;   // 4,6,8,10,12,14 –ø–∞—Ä = 8..28 –∫–∞—Ä—Ç–æ–∫

    // —Å–∫–∏–¥–∞—î–º–æ —Å—Ç–∞–Ω–∏ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
    moves   = 0;
    matched = 0;
    openCards = [];

    levelLabel.textContent   = level;
    matchesLabel.textContent = `${matched} / ${pairs}`;
    movesLabel.textContent   = moves;
    topLevel.textContent     = level;

    // –≥–æ—Ç—É—î–º–æ –∫–æ–ª–æ–¥—É
    cards = shuffle([
        ...icons.slice(0, pairs),
        ...icons.slice(0, pairs)
    ]);

    // –º–∞–ª—é—î–º–æ —Å—ñ—Ç–∫—É
    grid.innerHTML = "";
    cards.forEach((icon, idx) => {
        const c = document.createElement("div");
        c.className = "card";
        c.dataset.index = String(idx);
        c.onclick = () => reveal(idx);
        grid.appendChild(c);
    });
}

function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

/* ---------------- –õ–û–ì–Ü–ö–ê –ì–†–ò ---------------- */
function reveal(i) {
    const cardEls = document.querySelectorAll(".card");
    const card = cardEls[i];

    if (!card || card.classList.contains("matched") || card.classList.contains("open")) return;
    if (openCards.length === 2) return;

    card.classList.add("open");
    card.textContent = cards[i];
    openCards.push({ index: i, card, value: cards[i] });

    if (openCards.length === 2) {
        checkMatch();
    }
}

function checkMatch() {
    const [a, b] = openCards;

    // —Ä–∞—Ö—É—î–º–æ —Å–ø—Ä–æ–±—É –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (–∑–∞–≥–∞–ª—å–Ω—É —ñ –¥–ª—è —Ä—ñ–≤–Ω—è)
    moves++;
    totalMoves++;
    movesLabel.textContent = moves;

    if (a.value === b.value) {
        a.card.classList.remove("open");
        b.card.classList.remove("open");
        a.card.classList.add("matched");
        b.card.classList.add("matched");

        matched++;
        matchesLabel.textContent = `${matched} / ${cards.length / 2}`;
        openCards = [];

        if (matched === cards.length / 2) {
            setTimeout(nextLevel, 400);
        }
    } else {
        setTimeout(() => {
            a.card.classList.remove("open");
            b.card.classList.remove("open");
            a.card.textContent = "";
            b.card.textContent = "";
            openCards = [];
        }, 500);
    }
}

/* ---------------- –ü–ï–†–ï–•–Ü–î –ú–Ü–ñ –†–Ü–í–ù–Ø–ú–ò ---------------- */
function nextLevel() {
    // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —Å–ø—Ä–æ–±–∏ –¥–ª—è —Ü—å–æ–≥–æ —Ä—ñ–≤–Ω—è
    if (level >= 1 && level <= TOTAL_LEVELS) {
        movesPerLevel[level - 1] = moves;
    }

    if (level < TOTAL_LEVELS) {
        level++;
        loadLevel();
    } else {
        finishGame();
    }
}

/* ---------------- –§–Ü–ù–Ü–® ---------------- */
function finishGame() {
    stopTimer();

    // –Ω–∞ –≤—Å—è–∫ –≤–∏–ø–∞–¥–æ–∫ —â–µ —Ä–∞–∑ —Ñ—ñ–∫—Å—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å
    if (level >= 1 && level <= TOTAL_LEVELS) {
        movesPerLevel[level - 1] = moves;
    }

    gameScreen.classList.add("hidden");
    resultScreen.classList.remove("hidden");

    resName.textContent  = `–£—á–∞—Å–Ω–∏–∫: ${nameUser}`;
    resEmail.textContent = `Email: ${emailUser}`;
    resTime.textContent  = `–ß–∞—Å: ${formatTime(totalSeconds)}`;
    resMoves.textContent = `–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±: ${totalMoves}`;

    confettiBurst();
    sendToTelegram();
}

/* ---------------- –ö–û–ù–§–ï–¢–Ü ---------------- */
function confettiBurst() {
    if (typeof confetti !== "function") return;
    const end = Date.now() + 1500;

    (function frame() {
        confetti({
            particleCount: 8,
            spread: 360,
            ticks: 70,
            origin: { x: Math.random(), y: Math.random() - 0.3 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
    })();
}

/* ---------------- –ö–ù–û–ü–ö–ê "–î–û–ö–õ–ê–î–ù–û" ---------------- */
detailsBtn.addEventListener("click", () => {
    if (detailsBlock.classList.contains("hidden")) {
        let html = "<strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–± –∑–∞ —Ä—ñ–≤–Ω—è–º–∏:</strong><ul>";
        for (let i = 0; i < TOTAL_LEVELS; i++) {
            html += `<li>–†—ñ–≤–µ–Ω—å ${i + 1}: ${movesPerLevel[i]} —Å–ø—Ä–æ–±</li>`;
        }
        html += "</ul>";
        detailsBlock.innerHTML = html;
        detailsBlock.classList.remove("hidden");
        detailsBtn.textContent = "–°—Ö–æ–≤–∞—Ç–∏";
    } else {
        detailsBlock.classList.add("hidden");
        detailsBtn.textContent = "–î–æ–∫–ª–∞–¥–Ω–æ";
    }
});

/* ---------------- TELEGRAM ---------------- */
function sendToTelegram() {
    const TOKEN = "8517013691:AAElXeP_-V0-XqTIKJ9nFMUkwvXaW3qiziQ";
    const CHAT  = "1350269784";

    let text =
        "üß† –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ Memory-—Ç–µ—Å—Ç—É\n\n" +
        `üë§ –Ü–º‚Äô—è: ${nameUser}\n` +
        `‚úâÔ∏è –ü–æ—à—Ç–∞: ${emailUser}\n` +
        `‚è± –ß–∞—Å: ${formatTime(totalSeconds)} (${totalSeconds} —Å–µ–∫—É–Ω–¥)\n` +
        `üîÑ –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±: ${totalMoves}\n\n` +
        "üìä –°–ø—Ä–æ–±–∏ –∑–∞ —Ä—ñ–≤–Ω—è–º–∏:\n";

    for (let i = 0; i < TOTAL_LEVELS; i++) {
        text += ` ‚Ä¢ –†—ñ–≤–µ–Ω—å ${i + 1}: ${movesPerLevel[i]} —Å–ø—Ä–æ–±\n`;
    }

    text += "\n‚úî –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ";

    const url = `https://api.telegram.org/bot${TOKEN}/sendMessage` +
                `?chat_id=${CHAT}&text=${encodeURIComponent(text)}`;

    new Image().src = url;
}
</script>
</body>
</html>
